<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸»é¢˜æ¨¡å¼ - RabbitMQ æ•™å­¦</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
</head>
<body>
<nav class="navbar"><div class="container" style="max-width:1200px;display:flex;justify-content:space-between;align-items:center;">
    <a class="navbar-brand" th:href="@{/}"><i class="fas fa-plug"></i> RabbitMQ æ•™å­¦å¹³å°</a>
    <div style="display:flex;gap:1.5rem;"><a class="nav-link" th:href="@{/}">é¦–é¡µ</a><a class="nav-link" th:href="@{/quiz}">çŸ¥è¯†é—®ç­”</a></div>
</div></nav>
<div class="main-container demo-page">
    <a th:href="@{/}" class="back-link"><i class="fas fa-arrow-left"></i> è¿”å›é¦–é¡µ</a>
    <h2><i class="fas fa-sitemap" style="color:var(--accent-purple)"></i> ä¸»é¢˜æ¨¡å¼</h2>
    <p class="subtitle">Topic Exchange â€” ä½¿ç”¨é€šé…ç¬¦çµæ´»åŒ¹é… Routing Key</p>

    <div class="panel">
        <div class="panel-title"><i class="fas fa-project-diagram"></i> æ¶æ„å›¾è§£</div>
        <div class="flow-diagram">
            <div class="flow-node producer"><i class="fas fa-user" style="color:var(--accent-blue)"></i><span class="label">ç”Ÿäº§è€…</span></div>
            <div class="flow-arrow"><i class="fas fa-long-arrow-alt-right"></i></div>
            <div class="flow-node exchange"><i class="fas fa-exchange-alt" style="color:var(--accent-purple)"></i><span class="label">Topic Exchange</span><span class="sub">é€šé…ç¬¦åŒ¹é…</span></div>
            <div class="flow-arrow"><i class="fas fa-long-arrow-alt-right"></i></div>
            <div style="display:flex;flex-direction:column;gap:0.5rem;">
                <div style="display:flex;align-items:center;gap:0.5rem;">
                    <span style="font-size:0.7rem;color:var(--accent-blue);white-space:nowrap;">user.*</span>
                    <div class="flow-node consumer"><i class="fas fa-user" style="color:var(--accent-blue)"></i><span class="label">ç”¨æˆ·é˜Ÿåˆ—</span></div>
                </div>
                <div style="display:flex;align-items:center;gap:0.5rem;">
                    <span style="font-size:0.7rem;color:var(--accent-orange);white-space:nowrap;">order.*</span>
                    <div class="flow-node consumer"><i class="fas fa-shopping-cart" style="color:var(--accent-orange)"></i><span class="label">è®¢å•é˜Ÿåˆ—</span></div>
                </div>
            </div>
        </div>
        <div class="tip-card info" style="margin-top:1rem;">
            <h4>ğŸ“ é€šé…ç¬¦è§„åˆ™</h4>
            <ul>
                <li><code style="color:var(--accent-green)">*</code> â€” åŒ¹é…<strong>æ°å¥½ä¸€ä¸ª</strong>å•è¯ã€‚ä¾‹å¦‚ <code>user.*</code> åŒ¹é… <code>user.create</code>ï¼Œä¸åŒ¹é… <code>user.info.detail</code></li>
                <li><code style="color:var(--accent-green)">#</code> â€” åŒ¹é…<strong>é›¶ä¸ªæˆ–å¤šä¸ª</strong>å•è¯ã€‚ä¾‹å¦‚ <code>user.#</code> åŒ¹é… <code>user</code>ã€<code>user.create</code>ã€<code>user.info.detail</code></li>
            </ul>
        </div>
    </div>

    <div class="panel control-panel">
        <div class="panel-title"><i class="fas fa-paper-plane"></i> å‘é€æ¶ˆæ¯</div>
        <div style="display:flex;gap:0.75rem;margin-bottom:0.75rem;">
            <input type="text" class="form-control" id="rkInput" placeholder="Routing Key" value="user.create" style="max-width:200px;font-family:monospace;">
            <input type="text" class="form-control" id="msgInput" placeholder="æ¶ˆæ¯å†…å®¹..." value="æ–°ç”¨æˆ·æ³¨å†ŒæˆåŠŸ">
            <button class="btn-send" onclick="doSend()" style="white-space:nowrap;"><i class="fas fa-paper-plane"></i> å‘é€</button>
        </div>
        <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
            <button class="btn-preset" onclick="doTopic('user.create','æ–°ç”¨æˆ·æ³¨å†Œ')">ğŸ‘¤ user.create</button>
            <button class="btn-preset" onclick="doTopic('user.update','ç”¨æˆ·ä¿¡æ¯æ›´æ–°')">âœï¸ user.update</button>
            <button class="btn-preset" onclick="doTopic('order.create','æ–°è®¢å•åˆ›å»º')">ğŸ›’ order.create</button>
            <button class="btn-preset" onclick="doTopic('order.complete','è®¢å•å·²å®Œæˆ')">âœ… order.complete</button>
            <button class="btn-preset" onclick="doTopic('payment.success','æ”¯ä»˜æˆåŠŸ')">ğŸ’³ payment.success</button>
        </div>
        <p style="font-size:0.75rem;color:var(--text-secondary);margin-top:0.5rem;">
            ğŸ’¡ æç¤ºï¼š<code>payment.success</code> ä¸åŒ¹é…ä»»ä½•ç»‘å®šæ¨¡å¼ï¼ˆuser.* / order.*ï¼‰ï¼Œæ¶ˆæ¯å°†è¢«ä¸¢å¼ƒ
        </p>
    </div>

    <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center;">
            <div class="panel-title" style="margin-bottom:0;"><i class="fas fa-stream"></i> å®æ—¶æ¶ˆæ¯æ—¥å¿—</div>
            <button class="btn-preset" onclick="clearLogs('logBox')">æ¸…ç©º</button>
        </div>
        <div id="logBox" class="log-container" style="margin-top:0.75rem;">
            <div class="log-empty"><i class="fas fa-inbox"></i> æš‚æ— æ¶ˆæ¯</div>
        </div>
    </div>
</div>
<div class="footer">Â© 2025 RabbitMQ æ•™å­¦å¹³å°</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/app.js}"></script>
<script>
    connectSSE('topic', 'logBox');
    function doSend() {
        const rk = document.getElementById('rkInput').value.trim();
        const msg = document.getElementById('msgInput').value.trim();
        if (!rk || !msg) return showToast('è¯·è¾“å…¥ Routing Key å’Œæ¶ˆæ¯', 'error');
        sendMsg('/api/topic', {routingKey: rk, message: msg});
    }
    function doTopic(rk, msg) {
        document.getElementById('rkInput').value = rk;
        document.getElementById('msgInput').value = msg;
        doSend();
    }
    document.getElementById('msgInput').addEventListener('keypress', e => { if(e.key==='Enter') doSend(); });
</script>
</body>
</html>
