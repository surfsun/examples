<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ¥è¯†é—®ç­” - RabbitMQ æ•™å­¦</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
</head>
<body>
<nav class="navbar"><div class="container" style="max-width:1200px;display:flex;justify-content:space-between;align-items:center;">
    <a class="navbar-brand" th:href="@{/}"><i class="fas fa-plug"></i> RabbitMQ æ•™å­¦å¹³å°</a>
    <div style="display:flex;gap:1.5rem;"><a class="nav-link" th:href="@{/}">é¦–é¡µ</a><a class="nav-link active" th:href="@{/quiz}">çŸ¥è¯†é—®ç­”</a></div>
</div></nav>

<div class="main-container">
    <a th:href="@{/}" class="back-link"><i class="fas fa-arrow-left"></i> è¿”å›é¦–é¡µ</a>
    <h2 style="margin-bottom:0.5rem;"><i class="fas fa-question-circle" style="color:var(--accent-purple)"></i> RabbitMQ çŸ¥è¯†é—®ç­”</h2>
    <p style="color:var(--text-secondary);margin-bottom:1.5rem;">æ£€éªŒä½ çš„ RabbitMQ çŸ¥è¯†æŒæ¡ç¨‹åº¦</p>

    <div style="display:grid;grid-template-columns:1fr 260px;gap:1.5rem;">
        <!-- å·¦ä¾§ï¼šé¢˜ç›®åˆ—è¡¨ -->
        <div>
            <!-- åˆ†ç±»é€‰æ‹© -->
            <div class="category-tabs">
                <button class="category-tab active" onclick="loadCategory('all', this)">ğŸ“‹ å…¨éƒ¨</button>
                <button class="category-tab" onclick="loadCategory('basic', this)">ğŸŸ¢ åŸºç¡€</button>
                <button class="category-tab" onclick="loadCategory('advanced', this)">ğŸŸ¡ è¿›é˜¶</button>
                <button class="category-tab" onclick="loadCategory('expert', this)">ğŸ”´ é«˜çº§</button>
            </div>

            <!-- é¢˜ç›®åŒºåŸŸ -->
            <div id="questionsArea">
                <div class="log-empty" style="padding:3rem;"><i class="fas fa-spinner fa-spin"></i> åŠ è½½ä¸­...</div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šå¾—åˆ†é¢æ¿ -->
        <div>
            <div class="score-panel">
                <div class="score-number" id="scoreDisplay">0</div>
                <div class="score-label">å½“å‰å¾—åˆ†</div>
                <hr style="border-color:var(--border-color);margin:1rem 0;">
                <div style="display:flex;justify-content:space-around;font-size:0.85rem;">
                    <div><span style="color:var(--accent-green);font-weight:700;" id="correctCount">0</span><br><span style="color:var(--text-secondary)">æ­£ç¡®</span></div>
                    <div><span style="color:var(--accent-red);font-weight:700;" id="wrongCount">0</span><br><span style="color:var(--text-secondary)">é”™è¯¯</span></div>
                    <div><span style="color:var(--text-primary);font-weight:700;" id="totalCount">0</span><br><span style="color:var(--text-secondary)">å·²ç­”</span></div>
                </div>
                <button class="btn-send" style="width:100%;margin-top:1.25rem;" onclick="resetQuiz()">
                    <i class="fas fa-redo"></i> é‡æ–°å¼€å§‹
                </button>
            </div>

            <div class="tip-card info" style="margin-top:1rem;">
                <h4>ğŸ“– ç­”é¢˜è¯´æ˜</h4>
                <ul>
                    <li>å…± 15 é“é¢˜ï¼Œåˆ†ä¸‰ä¸ªéš¾åº¦</li>
                    <li>é€‰æ‹©ç­”æ¡ˆåå³æ—¶åˆ¤å®š</li>
                    <li>æ¯é¢˜é™„å¸¦è¯¦ç»†è§£æ</li>
                    <li>å¯æŒ‰åˆ†ç±»ç­›é€‰é¢˜ç›®</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="footer">Â© 2025 RabbitMQ æ•™å­¦å¹³å°</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/app.js}"></script>
<script>
let score = 0, correct = 0, wrong = 0, total = 0;
let answeredSet = new Set();

function loadCategory(category, btn) {
    // æ›´æ–°æ ‡ç­¾çŠ¶æ€
    document.querySelectorAll('.category-tab').forEach(b => b.classList.remove('active'));
    if (btn) btn.classList.add('active');

    fetch('/api/quiz/' + category)
        .then(r => r.json())
        .then(questions => renderQuestions(questions))
        .catch(() => showToast('åŠ è½½å¤±è´¥', 'error'));
}

function renderQuestions(questions) {
    const area = document.getElementById('questionsArea');
    if (!questions.length) {
        area.innerHTML = '<div class="log-empty">æš‚æ— é¢˜ç›®</div>';
        return;
    }

    area.innerHTML = questions.map(q => {
        const categoryLabel = {'basic':'ğŸŸ¢ åŸºç¡€','advanced':'ğŸŸ¡ è¿›é˜¶','expert':'ğŸ”´ é«˜çº§'}[q.category] || '';
        const answered = answeredSet.has(q.id);
        return `
        <div class="quiz-card" id="q-${q.id}">
            <div style="margin-bottom:0.75rem;">
                <span class="q-number">${q.id}</span>
                <span class="q-text">${q.question}</span>
                <span class="card-tag" style="margin-left:0.5rem;vertical-align:middle;">${categoryLabel}</span>
            </div>
            <div class="options-area">
                ${q.options.map((opt, i) => `
                    <div class="quiz-option ${answered ? 'disabled' : ''} ${answered && i === q.answer ? 'correct' : ''}"
                         ${answered ? '' : `onclick="selectAnswer(${q.id}, ${i}, ${q.answer}, this)"`}
                         data-idx="${i}">
                        <strong>${String.fromCharCode(65+i)}.</strong> ${opt}
                    </div>
                `).join('')}
            </div>
            <div class="explanation ${answered ? 'show correct-bg' : ''}" id="exp-${q.id}">
                <strong>ğŸ’¡ è§£æï¼š</strong>${q.explanation}
            </div>
        </div>`;
    }).join('');
}

function selectAnswer(qId, selected, correct_answer, el) {
    if (answeredSet.has(qId)) return;
    answeredSet.add(qId);

    const card = document.getElementById('q-' + qId);
    const options = card.querySelectorAll('.quiz-option');
    const isCorrect = selected === correct_answer;

    options.forEach((opt, i) => {
        opt.classList.add('disabled');
        if (i === correct_answer) opt.classList.add('correct');
        if (i === selected && !isCorrect) opt.classList.add('wrong');
    });

    const exp = document.getElementById('exp-' + qId);
    exp.classList.add('show', isCorrect ? 'correct-bg' : 'wrong-bg');

    total++;
    if (isCorrect) { correct++; score += 10; }
    else { wrong++; }

    updateScore();
}

function updateScore() {
    document.getElementById('scoreDisplay').textContent = score;
    document.getElementById('correctCount').textContent = correct;
    document.getElementById('wrongCount').textContent = wrong;
    document.getElementById('totalCount').textContent = total;
}

function resetQuiz() {
    score = 0; correct = 0; wrong = 0; total = 0;
    answeredSet.clear();
    updateScore();
    document.querySelector('.category-tab.active').click();
}

// åˆå§‹åŠ è½½å…¨éƒ¨é¢˜ç›®
loadCategory('all', null);
</script>
</body>
</html>
